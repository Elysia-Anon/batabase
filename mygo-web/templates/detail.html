
{% extends 'layout.html' %}

{% block content %}

<style>
    .stats-grid-mobile {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 10px;
        margin-bottom: 20px;
    }
    .stats-grid-mobile h3 { font-size: 1.5rem !important; margin-bottom: 5px; }
    .stats-grid-mobile small { font-size: 0.8rem; }

    .role-badge {
        white-space: nowrap;
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        background-color: #f1c40f;
        color: #000;
        font-weight: bold;
    }

    @media (max-width: 600px) {
        .hide-on-mobile { display: none; }
        table { font-size: 0.9rem; }
    }
</style>

<nav aria-label="breadcrumb">
  <ul>
    <li><a href="/">é¦–é¡µ</a></li>
    <li>{{ band.name }}</li>
  </ul>
</nav>

<hgroup>
    <h1>{{ band.name }}</h1>
    <h2>é˜Ÿé•¿: {{ band.leader_name }} | æˆå‘˜æ•°: {{ band.member_count }}äºº</h2>
</hgroup>

{% if stats %}
<article>
    <header><strong>ğŸ“Š ç²‰ä¸å¤§æ•°æ® </strong></header>
    <div class="grid stats-grid-mobile" style="text-align: center;">
        <div>
            <h3>{{ stats['ç²‰ä¸æ€»æ•°'] }}</h3>
            <small>æ€»å…³æ³¨</small>
        </div>
        <div>
            <h3>{{ stats['å¹³å‡å¹´é¾„'] | float | round(1) }} å²</h3>
            <small>å¹³å‡å¹´é¾„</small>
        </div>
        <div>
            <h3>{{ stats['å¥³æ€§ç²‰ä¸æ•°'] }}</h3>
            <small>å¥³æ€§ç²‰ä¸</small>
        </div>
        <div>
            <h3>{{ stats['æœ¬ç§‘ç²‰ä¸æ•°'] }}</h3>
            <small>æœ¬ç§‘åŠä»¥ä¸Š</small>
        </div>
    </div>
</article>
{% endif %}

<h3>ğŸ¤ æˆå‘˜åå•</h3>
<figure>
    <table role="grid">
        <thead>
            <tr>
                <th scope="col">å§“å</th>
                <th scope="col">æ‹…å½“</th>
                <th scope="col" class="hide-on-mobile">æ€§åˆ«</th>
                <th scope="col" class="hide-on-mobile">å¹´é¾„</th>
                <th scope="col">åŠ å…¥æ—¶é—´</th>
            </tr>
        </thead>
        <tbody>
            {% for m in members %}
            <tr>
                <th scope="row">{{ m.name }}</th>
                <td><span class="role-badge">{{ m.role }}</span></td>
                <td class="hide-on-mobile">{{ m.gender }}</td>
                <td class="hide-on-mobile">{{ m.age }}</td>
                <td>{{ m.join_date|string|truncate(10, True, '') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>

<hr>

<h3>ğŸ’¿ ä¸“è¾‘ & æ­Œæ›² (Discography)</h3>
<div class="grid">
    {% for album in albums %}
    <article style="padding: 0;">
        <header style="padding: 15px; background: rgba(0,0,0,0.2);">
            <hgroup style="margin-bottom: 0;">
                <h4 style="font-size: 1.1rem;">{{ album.title }}</h4>
                <small>ğŸ“… {{ album.release_date }} | â­ {{ album.avg_score }}</small>
            </hgroup>
        </header>
        <div style="padding: 15px;">
            <details>
                <summary>æŸ¥çœ‹ {{ album.songs | length }} é¦–æ”¶å½•æ›²</summary>
                <table role="grid" style="margin-bottom: 0;">
                    {% for song in album.songs %}
                    <tr>
                        <td style="padding: 8px;">ğŸµ {{ song.title }}</td>
                        <td style="text-align: right; opacity: 0.7; padding: 8px;">{{ song.duration }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </details>
        </div>
    </article>
    {% else %}
    <p>æš‚æ— ä¸“è¾‘æ•°æ®</p>
    {% endfor %}
</div>

<hr>


<h3>ğŸ« è¿‘æœŸæ¼”å‡º (Live Events)</h3>
<figure>
    <table role="grid">
        <thead>
            <tr>
                <th>æ¼”å‡ºåç§°</th>
                <th>æ—¥æœŸ</th>
                <th class="hide-on-mobile">åœºé¦†</th>
                <th>çŠ¶æ€</th>
            </tr>
        </thead>
        <tbody>
            {% for concert in concerts %}
            <tr>
                <td><strong>{{ concert.name }}</strong></td>
                <td>{{ concert.concert_date }}</td>
                <td class="hide-on-mobile">{{ concert.venue }}</td>
                <td>
                    {% if concert.status == 'å·²ç»“æŸ' %}
                        <small style="opacity: 0.6;">ğŸ å·²ç»“æŸ</small>
                    {% else %}
                        <mark style="background: #e74c3c; color: white; padding: 2px 6px; font-size: 0.8rem;">ğŸ”¥ {{ concert.status }}</mark>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4">æš‚æ— æ¼”å‡ºä¿¡æ¯</td></tr>
            {% endfor %}
        </tbody>
    </table>
</figure>

<hr>

<h3>ğŸ’¬ æœ€æ–°ä¹è¯„</h3>
<div class="grid">
    {% for review in reviews %}
    <article style="padding: 15px; margin-bottom: 10px; border-left: 4px solid var(--primary);">
        <header style="margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;">
            <strong>ğŸ‘¤ {{ review.fan_name }}</strong>
            <small style="font-size: 0.7rem;">ã€Š{{ review.album_title }}ã€‹</small>
        </header>
        <div style="color: gold; font-size: 0.9rem; margin-bottom: 5px;">
            {% for i in range(review.score | int) %}â˜…{% endfor %} {{ review.score }}
        </div>
        <p style="margin-bottom: 0; font-style: italic;">â€œ {{ review.comment }} â€</p>
    </article>
    {% else %}
    <div style="padding: 20px; text-align: center; opacity: 0.6;">
        æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘ï¼
    </div>
    {% endfor %}
</div>

<hr>

{% if user and user.type == 'fan' %}
    <article>
        <header><strong>ğŸ“ å‘è¡¨ä½ çš„ä¹è¯„</strong></header>
        <form action="/add_review" method="POST">
            <input type="hidden" name="album_id" value="1"> 
            <div class="grid">
                <label>
                    è¯„åˆ† (0-10)
                    <input type="number" name="score" min="0" max="10" step="0.1" required placeholder="10.0">
                </label>
                <label>
                    è¯„è®ºå†…å®¹
                    <input type="text" name="comment" placeholder="ç¥æ›²ï¼å¹çˆ†ï¼" required>
                </label>
            </div>
            <button type="submit">æäº¤è¯„ä»·</button>
        </form>
    </article>
{% elif not user %}
    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;">
        ğŸ’¡ æƒ³è¦å‘è¡¨è¯„è®ºï¼Ÿè¯· <a href="/login">ç™»å½•æ­Œè¿·è´¦å·</a>
    </div>
{% endif %}

{% endblock %}

